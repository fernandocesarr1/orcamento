<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Or√ßament√°rio Familiar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- SheetJS para exportar Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <div id="root"></div>

    <script>
       // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAgopSuSjeQ26UL85eYb11w4BbbNtBg5QE",
  authDomain: "orcamento-familiar-dc2e6.firebaseapp.com",
  projectId: "orcamento-familiar-dc2e6",
  storageBucket: "orcamento-familiar-dc2e6.firebasestorage.app",
  messagingSenderId: "21809188621",
  appId: "1:21809188621:web:103d45c3353106ebf5aa44",
  measurementId: "G-4E95DZRK3F"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        // Inicializar Firebase
        let database;
        let isFirebaseInitialized = false;

        try {
            if (firebaseConfig.apiKey !== "SUA_API_KEY_AQUI") {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                isFirebaseInitialized = true;
            }
        } catch (error) {
            console.error("Erro ao inicializar Firebase:", error);
        }

        // Estado da aplica√ß√£o
        let state = {
            isAuthenticated: false,
            showLogin: true,
            showChangePassword: false,
            loginPassword: '',
            newPassword: '',
            confirmPassword: '',
            loginError: '',
            passwordError: '',
            activeTab: 'dashboard',
            categoriasFixas: ['Escola', 'Diarista', 'Internet', '√Ågua', 'Luz', 'Clube'],
            categoriasVariaveis: ['Supermercado', 'Farm√°cia', 'Lazer'],
            limites: {},
            gastos: [],
            nomes: ['Fernando', 'Estef√¢nia'],
            showAddCategory: false,
            showEditNames: false,
            selectedCategory: '',
            selectedYear: new Date().getFullYear(),
            formData: {
                tipo: 'fixo',
                categoria: '',
                valor: '',
                data: new Date().toISOString().split('T')[0],
                descricao: '',
                responsavel: 'Fernando'
            },
            tempNome1: 'Fernando',
            tempNome2: 'Estef√¢nia',
            newCategoryName: '',
            categoryType: 'fixo',
            charts: {}
        };

        const DEFAULT_PASSWORD = 'familia2024';

        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        function checkStoredPassword() {
            if (!isFirebaseInitialized) return;
            database.ref('auth/passwordHash').once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    database.ref('auth/passwordHash').set(simpleHash(DEFAULT_PASSWORD));
                }
            });
        }

        function handleLogin() {
            if (!state.loginPassword) {
                state.loginError = 'Digite a senha';
                render();
                return;
            }

            if (!isFirebaseInitialized) {
                state.loginError = 'Firebase n√£o configurado';
                render();
                return;
            }

            const passwordHash = simpleHash(state.loginPassword);
            
            database.ref('auth/passwordHash').once('value', (snapshot) => {
                const storedHash = snapshot.val();
                
                if (storedHash === passwordHash) {
                    state.isAuthenticated = true;
                    state.showLogin = false;
                    state.loginError = '';
                    state.loginPassword = '';
                    loadFromFirebase();
                    render();
                } else {
                    state.loginError = 'Senha incorreta';
                    render();
                }
            });
        }

        function handleChangePassword() {
            if (!state.newPassword || !state.confirmPassword) {
                state.passwordError = 'Preencha todos os campos';
                render();
                return;
            }

            if (state.newPassword.length < 6) {
                state.passwordError = 'A senha deve ter pelo menos 6 caracteres';
                render();
                return;
            }

            if (state.newPassword !== state.confirmPassword) {
                state.passwordError = 'As senhas n√£o coincidem';
                render();
                return;
            }

            const newPasswordHash = simpleHash(state.newPassword);
            database.ref('auth/passwordHash').set(newPasswordHash);
            
            state.showChangePassword = false;
            state.newPassword = '';
            state.confirmPassword = '';
            state.passwordError = '';
            alert('Senha alterada com sucesso! ‚úÖ');
            render();
        }

        function handleLogout() {
            state.isAuthenticated = false;
            state.showLogin = true;
            state.activeTab = 'dashboard';
            render();
        }

        function syncWithFirebase() {
            if (!isFirebaseInitialized) return;
            database.ref('categorias').set({
                fixas: state.categoriasFixas,
                variaveis: state.categoriasVariaveis
            });
            database.ref('limites').set(state.limites);
            database.ref('nomes').set(state.nomes);
        }

        function saveGastoToFirebase(gasto) {
            if (!isFirebaseInitialized) return;
            database.ref('gastos/' + gasto.id).set(gasto);
        }

        function removeGastoFromFirebase(id) {
            if (!isFirebaseInitialized) return;
            database.ref('gastos/' + id).remove();
        }

        function loadFromFirebase() {
            if (!isFirebaseInitialized) return;

            database.ref('categorias').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    state.categoriasFixas = data.fixas || state.categoriasFixas;
                    state.categoriasVariaveis = data.variaveis || state.categoriasVariaveis;
                    render();
                }
            });

            database.ref('limites').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    state.limites = data;
                    render();
                }
            });

            database.ref('nomes').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    state.nomes = data;
                    render();
                }
            });

            database.ref('gastos').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    state.gastos = Object.values(data);
                    render();
                }
            });
        }

        function calcularTotalCategoria(categoria, tipo) {
            return state.gastos
                .filter(g => g.categoria === categoria && g.tipo === tipo)
                .reduce((sum, g) => sum + g.valor, 0);
        }

        function calcularTotalPorPessoa(pessoa) {
            return state.gastos
                .filter(g => g.responsavel === pessoa)
                .reduce((sum, g) => sum + g.valor, 0);
        }

        function verificarLimite(categoria, total) {
            const limite = state.limites[categoria];
            if (!limite) return null;
            const percentual = (total / limite) * 100;
            if (percentual >= 100) return 'danger';
            if (percentual >= 80) return 'warning';
            return 'safe';
        }

        function handleAddCategory() {
            if (state.newCategoryName.trim()) {
                if (state.categoryType === 'fixo') {
                    state.categoriasFixas.push(state.newCategoryName);
                } else {
                    state.categoriasVariaveis.push(state.newCategoryName);
                }
                syncWithFirebase();
                state.newCategoryName = '';
                state.showAddCategory = false;
                render();
            }
        }

        function handleAddGasto() {
            if (state.formData.categoria && state.formData.valor && state.formData.data && state.formData.responsavel) {
                const novoGasto = {
                    id: Date.now(),
                    ...state.formData,
                    valor: parseFloat(state.formData.valor)
                };
                state.gastos.push(novoGasto);
                saveGastoToFirebase(novoGasto);
                state.formData = {
                    tipo: 'fixo',
                    categoria: '',
                    valor: '',
                    data: new Date().toISOString().split('T')[0],
                    descricao: '',
                    responsavel: state.nomes[0]
                };
                render();
            }
        }

        function handleRemoveGasto(id) {
            state.gastos = state.gastos.filter(g => g.id !== id);
            removeGastoFromFirebase(id);
            render();
        }

        function handleSetLimite(categoria, valor) {
            state.limites[categoria] = parseFloat(valor) || 0;
            syncWithFirebase();
            render();
        }

        function handleSaveNames() {
            state.nomes = [state.tempNome1, state.tempNome2];
            syncWithFirebase();
            state.showEditNames = false;
            render();
        }

        function exportToExcel() {
            if (state.gastos.length === 0) {
                alert('‚ö†Ô∏è N√£o h√° gastos para exportar!');
                return;
            }

            const dadosExportacao = state.gastos.map(gasto => ({
                'Data': new Date(gasto.data + 'T00:00:00').toLocaleDateString('pt-BR'),
                'Tipo': gasto.tipo === 'fixo' ? 'Fixo' : 'Vari√°vel',
                'Categoria': gasto.categoria,
                'Respons√°vel': gasto.responsavel,
                'Valor (R$)': gasto.valor.toFixed(2),
                'Descri√ß√£o': gasto.descricao || '-'
            }));

            dadosExportacao.sort((a, b) => {
                const dataA = a['Data'].split('/').reverse().join('');
                const dataB = b['Data'].split('/').reverse().join('');
                return dataB.localeCompare(dataA);
            });

            const totals = getTotals();
            const resumo = [
                { 'Data': 'RESUMO GERAL', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': '', 'Descri√ß√£o': '' },
                { 'Data': 'Total Geral', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': totals.totalGeral.toFixed(2), 'Descri√ß√£o': '' },
                { 'Data': 'Total Fixos', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': totals.totalFixos.toFixed(2), 'Descri√ß√£o': '' },
                { 'Data': 'Total Vari√°veis', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': totals.totalVariaveis.toFixed(2), 'Descri√ß√£o': '' },
                { 'Data': '', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': '', 'Descri√ß√£o': '' },
                { 'Data': state.nomes[0], 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': calcularTotalPorPessoa(state.nomes[0]).toFixed(2), 'Descri√ß√£o': '' },
                { 'Data': state.nomes[1], 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': calcularTotalPorPessoa(state.nomes[1]).toFixed(2), 'Descri√ß√£o': '' },
                { 'Data': '', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': '', 'Descri√ß√£o': '' },
                { 'Data': 'DETALHAMENTO', 'Tipo': '', 'Categoria': '', 'Respons√°vel': '', 'Valor (R$)': '', 'Descri√ß√£o': '' }
            ];

            const dadosCompletos = [...resumo, ...dadosExportacao];
            const ws = XLSX.utils.json_to_sheet(dadosCompletos);
            ws['!cols'] = [
                { wch: 12 }, { wch: 10 }, { wch: 15 }, 
                { wch: 15 }, { wch: 12 }, { wch: 30 }
            ];

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Gastos');

            const dataAtual = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
            const nomeArquivo = `Orcamento_Familiar_${dataAtual}.xlsx`;

            XLSX.writeFile(wb, nomeArquivo);
            alert('‚úÖ Planilha exportada com sucesso!');
        }

        function getTotals() {
            const totalFixos = state.gastos.filter(g => g.tipo === 'fixo').reduce((sum, g) => sum + g.valor, 0);
            const totalVariaveis = state.gastos.filter(g => g.tipo === 'variavel').reduce((sum, g) => sum + g.valor, 0);
            return { totalFixos, totalVariaveis, totalGeral: totalFixos + totalVariaveis };
        }

        function processarDadosMensais(ano) {
            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const dadosMensais = {
                labels: meses,
                total: new Array(12).fill(0),
                pessoa1: new Array(12).fill(0),
                pessoa2: new Array(12).fill(0)
            };

            state.gastos.forEach(gasto => {
                const dataGasto = new Date(gasto.data + 'T00:00:00');
                if (dataGasto.getFullYear() === ano) {
                    const mes = dataGasto.getMonth();
                    dadosMensais.total[mes] += gasto.valor;
                    if (gasto.responsavel === state.nomes[0]) {
                        dadosMensais.pessoa1[mes] += gasto.valor;
                    } else {
                        dadosMensais.pessoa2[mes] += gasto.valor;
                    }
                }
            });

            return dadosMensais;
        }

        function processarDadosCategoria(categoria, ano) {
            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const dados = new Array(12).fill(0);

            state.gastos.forEach(gasto => {
                const dataGasto = new Date(gasto.data + 'T00:00:00');
                if (dataGasto.getFullYear() === ano && gasto.categoria === categoria) {
                    const mes = dataGasto.getMonth();
                    dados[mes] += gasto.valor;
                }
            });

            return { labels: meses, valores: dados };
        }

        function getAnosDisponiveis() {
            const anos = new Set();
            state.gastos.forEach(gasto => {
                const ano = new Date(gasto.data + 'T00:00:00').getFullYear();
                anos.add(ano);
            });
            return Array.from(anos).sort((a, b) => b - a);
        }

        function criarGraficoMensal() {
            const canvas = document.getElementById('graficoMensal');
            if (!canvas) return;

            if (state.charts.mensal) {
                state.charts.mensal.destroy();
            }

            const dados = processarDadosMensais(state.selectedYear);
            const ctx = canvas.getContext('2d');
            
            state.charts.mensal = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dados.labels,
                    datasets: [
                        {
                            label: 'Total Geral',
                            data: dados.total,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: state.nomes[0],
                            data: dados.pessoa1,
                            borderColor: 'rgb(251, 146, 60)',
                            backgroundColor: 'rgba(251, 146, 60, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: state.nomes[1],
                            data: dados.pessoa2,
                            borderColor: 'rgb(168, 85, 247)',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return (context.dataset.label || '') + ': R$ ' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toFixed(0);
                                }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function criarGraficoCategoria() {
            const canvas = document.getElementById('graficoCategoria');
            if (!canvas) return;

            if (state.charts.categoria) {
                state.charts.categoria.destroy();
            }

            const dados = processarDadosCategoria(state.selectedCategory, state.selectedYear);
            const ctx = canvas.getContext('2d');
            
            state.charts.categoria = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dados.labels,
                    datasets: [{
                        label: state.selectedCategory,
                        data: dados.valores,
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.2)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: 'rgb(34, 197, 94)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toFixed(0);
                                }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateSelectedYear(ano) {
            state.selectedYear = parseInt(ano);
            criarGraficoMensal();
            criarGraficoCategoria();
        }

        function updateSelectedCategory(categoria) {
            state.selectedCategory = categoria;
            criarGraficoCategoria();
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex items-center justify-center px-4 py-8 relative overflow-hidden">
                    <div class="absolute inset-0 overflow-hidden">
                        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse"></div>
                        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse" style="animation-delay: 1s;"></div>
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse" style="animation-delay: 2s;"></div>
                    </div>
                    
                    <div class="absolute top-20 left-10 float-animation opacity-20">
                        <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                            <circle cx="30" cy="30" r="25" fill="#667eea"/>
                        </svg>
                    </div>
                    <div class="absolute bottom-20 right-10 float-animation opacity-20" style="animation-delay: 1s;">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                            <circle cx="40" cy="40" r="35" fill="#764ba2"/>
                        </svg>
                    </div>
                    
                    <div class="relative z-10 w-full max-w-md fade-in">
                        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 p-8 text-center relative">
                                <div class="absolute inset-0 bg-black opacity-10"></div>
                                <div class="relative z-10">
                                    <div class="inline-block mb-4">
                                        <div class="relative">
                                            <div class="absolute inset-0 bg-white rounded-full blur-xl opacity-50"></div>
                                            <svg class="relative" width="120" height="120" viewBox="0 0 120 120" fill="none">
                                                <rect x="20" y="35" width="80" height="60" rx="8" fill="white" opacity="0.9"/>
                                                <circle cx="60" cy="65" r="15" fill="#667eea"/>
                                                <circle cx="60" cy="65" r="8" fill="white"/>
                                                <rect x="54" y="65" width="12" height="15" fill="white"/>
                                                <circle cx="35" cy="25" r="12" fill="#FFD700" opacity="0.9"/>
                                                <circle cx="85" cy="30" r="10" fill="#FFD700" opacity="0.8"/>
                                                <circle cx="45" cy="15" r="8" fill="#FFD700" opacity="0.7"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <h1 class="text-3xl font-bold text-white mb-2">Bem-vindo! üëã</h1>
                                    <p class="text-white text-opacity-90 text-sm">Controle Or√ßament√°rio Familiar</p>
                                </div>
                            </div>
                            
                            <div class="p-8">
                                ${!isFirebaseInitialized ? `
                                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg mb-6">
                                        <div class="flex items-start">
                                            <div class="text-2xl mr-3">‚ö†Ô∏è</div>
                                            <div>
                                                <p class="font-bold text-yellow-800">Firebase n√£o configurado</p>
                                                <p class="text-sm text-yellow-700 mt-1">Configure o Firebase no c√≥digo para usar o sistema.</p>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}

                                <div class="mb-6">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">üîê Digite sua senha</label>
                                    <div class="relative">
                                        <input
                                            type="password"
                                            value="${state.loginPassword}"
                                            onchange="state.loginPassword = this.value; state.loginError = ''; render();"
                                            onkeypress="if(event.key === 'Enter') handleLogin()"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            class="w-full px-4 py-3 pr-12 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-200 focus:border-purple-500 transition-all"
                                            autofocus
                                        />
                                        <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400">üîí</div>
                                    </div>
                                </div>

                                ${state.loginError ? `
                                    <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-lg mb-6 fade-in">
                                        <div class="flex items-center">
                                            <div class="text-xl mr-3">‚ùå</div>
                                            <p class="text-red-700 font-medium">${state.loginError}</p>
                                        </div>
                                    </div>
                                ` : ''}

                                <button
                                    onclick="handleLogin()"
                                    class="w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white py-4 rounded-xl font-bold text-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200"
                                >
                                    ‚ú® Entrar no Sistema
                                </button>

                                <div class="mt-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-5 border-2 border-blue-100">
                                    <div class="flex items-start">
                                        <div class="text-2xl mr-3 mt-1">üí°</div>
                                        <div>
                                            <p class="font-bold text-blue-900 mb-2">Primeira vez aqui?</p>
                                            <p class="text-sm text-blue-800 mb-2">Use a senha padr√£o:</p>
                                            <div class="bg-white px-4 py-2 rounded-lg inline-block border-2 border-blue-200">
                                                <code class="text-blue-600 font-bold text-lg">familia2024</code>
                                            </div>
                                            <p class="text-xs text-blue-600 mt-3">üí° Voc√™ pode alter√°-la depois nas configura√ß√µes</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-6 text-gray-600 text-sm">
                            <p>üîí Seus dados est√£o seguros e sincronizados</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const totals = getTotals();
            return `
                <div class="space-y-6">
                    <div class="flex justify-end">
                        <button onclick="exportToExcel()" class="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition-all flex items-center gap-2 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                            <span class="text-xl">üìä</span>Exportar para Excel
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-blue-100 text-sm">Total Geral</p>
                            <p class="text-3xl font-bold mt-1">R$ ${totals.totalGeral.toFixed(2)}</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-green-100 text-sm">Gastos Fixos</p>
                            <p class="text-3xl font-bold mt-1">R$ ${totals.totalFixos.toFixed(2)}</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-purple-100 text-sm">Gastos Vari√°veis</p>
                            <p class="text-3xl font-bold mt-1">R$ ${totals.totalVariaveis.toFixed(2)}</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Gastos por Pessoa</h2>
                            <button onclick="openEditNames()" class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1">
                                üë§ Editar Nomes
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${state.nomes.map(nome => {
                                const total = calcularTotalPorPessoa(nome);
                                const quantidade = state.gastos.filter(g => g.responsavel === nome).length;
                                return `
                                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border-2 border-orange-200">
                                        <p class="text-sm text-orange-800 font-semibold">üë§ ${nome}</p>
                                        <p class="text-2xl font-bold text-orange-900 mt-1">R$ ${total.toFixed(2)}</p>
                                        <p class="text-xs text-orange-700 mt-1">${quantidade} gasto${quantidade !== 1 ? 's' : ''}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Gastos Fixos</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${state.categoriasFixas.map(cat => {
                                const total = calcularTotalCategoria(cat, 'fixo');
                                return `
                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                        <p class="text-sm text-gray-600 font-medium">${cat}</p>
                                        <p class="text-2xl font-bold text-gray-800 mt-1">R$ ${total.toFixed(2)}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Gastos Vari√°veis</h2>
                        <div class="space-y-4">
                            ${state.categoriasVariaveis.map(cat => {
                                const total = calcularTotalCategoria(cat, 'variavel');
                                const limite = state.limites[cat] || 0;
                                const status = verificarLimite(cat, total);
                                const percentual = limite > 0 ? (total / limite) * 100 : 0;
                                
                                return `
                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                        <div class="flex justify-between items-start mb-2">
                                            <div class="flex-1">
                                                <p class="text-sm text-gray-600 font-medium">${cat}</p>
                                                <p class="text-2xl font-bold text-gray-800 mt-1">R$ ${total.toFixed(2)}</p>
                                            </div>
                                            <div class="text-right">
                                                <input type="number" placeholder="Limite" value="${limite || ''}" onchange="handleSetLimite('${cat}', this.value)" class="w-28 px-3 py-1 border border-gray-300 rounded-md text-sm"/>
                                                <p class="text-xs text-gray-500 mt-1">Limite</p>
                                            </div>
                                        </div>
                                        ${limite > 0 ? `
                                            <div class="mt-3">
                                                <div class="flex justify-between text-xs text-gray-600 mb-1">
                                                    <span>${percentual.toFixed(0)}% usado</span>
                                                    <span>R$ ${limite.toFixed(2)}</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full transition-all ${status === 'danger' ? 'bg-red-500' : status === 'warning' ? 'bg-yellow-500' : 'bg-green-500'}" style="width: ${Math.min(percentual, 100)}%"></div>
                                                </div>
                                                ${status === 'danger' ? '<div class="flex items-center gap-2 mt-2 text-red-600 text-sm">‚ö†Ô∏è Limite atingido!</div>' : ''}
                                                ${status === 'warning' ? '<div class="flex items-center gap-2 mt-2 text-yellow-600 text-sm">‚ö†Ô∏è Pr√≥ximo do limite</div>' : ''}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAddGasto() {
            return `
                <div class="bg-white rounded-xl shadow-md p-6 max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Adicionar Gasto</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Quem fez o gasto?</label>
                            <select onchange="updateFormData('responsavel', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                ${state.nomes.map(nome => `<option value="${nome}" ${state.formData.responsavel === nome ? 'selected' : ''}>${nome}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Gasto</label>
                            <select onchange="updateFormData('tipo', this.value); updateFormData('categoria', '')" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="fixo" ${state.formData.tipo === 'fixo' ? 'selected' : ''}>Fixo</option>
                                <option value="variavel" ${state.formData.tipo === 'variavel' ? 'selected' : ''}>Vari√°vel</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select onchange="updateFormData('categoria', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="">Selecione uma categoria</option>
                                ${(state.formData.tipo === 'fixo' ? state.categoriasFixas : state.categoriasVariaveis).map(cat => `
                                    <option value="${cat}" ${state.formData.categoria === cat ? 'selected' : ''}>${cat}</option>
                                `).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                            <input type="number" step="0.01" value="${state.formData.valor}" onchange="updateFormData('valor', this.value)" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                            <input type="date" value="${state.formData.data}" onchange="updateFormData('data', this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                            <textarea onchange="updateFormData('descricao', this.value)" placeholder="Descreva o gasto (opcional)" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${state.formData.descricao}</textarea>
                        </div>
                        <button onclick="handleAddGasto()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">‚ûï Adicionar Gasto</button>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <button onclick="openAddCategory()" class="text-blue-600 hover:text-blue-700 font-medium text-sm">‚ûï Adicionar Nova Categoria</button>
                    </div>
                </div>
            `;
        }

        function renderGraficos() {
            const anos = getAnosDisponiveis();
            const todasCategorias = [...state.categoriasFixas, ...state.categoriasVariaveis];
            
            if (state.gastos.length === 0) {
                return `
                    <div class="bg-white rounded-xl shadow-md p-8 text-center">
                        <div class="text-6xl mb-4">üìä</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Nenhum dado para visualizar</h2>
                        <p class="text-gray-600">Adicione alguns gastos para ver os gr√°ficos</p>
                    </div>
                `;
            }

            return `
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-md p-4">
                        <div class="flex items-center gap-4">
                            <label class="text-sm font-semibold text-gray-700">üìÖ Ano:</label>
                            <select onchange="updateSelectedYear(this.value)" class="px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium">
                                ${anos.map(ano => `<option value="${ano}" ${ano === state.selectedYear ? 'selected' : ''}>${ano}</option>`).join('')}
                            </select>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üìà Evolu√ß√£o Mensal de Gastos</h2>
                        <p class="text-sm text-gray-600 mb-6">Acompanhe os gastos totais e de cada pessoa ao longo do ano</p>
                        <div style="height: 400px;"><canvas id="graficoMensal"></canvas></div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 mb-2">üìä An√°lise por Categoria</h2>
                                <p class="text-sm text-gray-600">Selecione uma categoria para ver a evolu√ß√£o mensal</p>
                            </div>
                            <select onchange="updateSelectedCategory(this.value)" class="px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 font-medium">
                                ${todasCategorias.map(cat => `<option value="${cat}" ${cat === state.selectedCategory ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div style="height: 400px;"><canvas id="graficoCategoria"></canvas></div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl shadow-md p-6 border-2 border-blue-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">üìã Resumo de ${state.selectedYear}</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${(() => {
                                const gastosAno = state.gastos.filter(g => new Date(g.data + 'T00:00:00').getFullYear() === state.selectedYear);
                                const totalAno = gastosAno.reduce((sum, g) => sum + g.valor, 0);
                                const mediaMensal = totalAno / 12;
                                const maiorGasto = Math.max(...gastosAno.map(g => g.valor), 0);
                                const quantidadeGastos = gastosAno.length;
                                
                                return `
                                    <div class="bg-white rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 mb-1">Total do Ano</p>
                                        <p class="text-xl font-bold text-blue-600">R$ ${totalAno.toFixed(2)}</p>
                                    </div>
                                    <div class="bg-white rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 mb-1">M√©dia Mensal</p>
                                        <p class="text-xl font-bold text-green-600">R$ ${mediaMensal.toFixed(2)}</p>
                                    </div>
                                    <div class="bg-white rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 mb-1">Maior Gasto</p>
                                        <p class="text-xl font-bold text-orange-600">R$ ${maiorGasto.toFixed(2)}</p>
                                    </div>
                                    <div class="bg-white rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 mb-1">Total de Gastos</p>
                                        <p class="text-xl font-bold text-purple-600">${quantidadeGastos}</p>
                                    </div>
                                `;
                            })()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHistorico() {
            const sortedGastos = [...state.gastos].sort((a, b) => new Date(b.data) - new Date(a.data));
            
            return `
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Hist√≥rico de Gastos</h2>
                        <button onclick="exportToExcel()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 font-semibold shadow-md hover:shadow-lg transform hover:scale-105">
                            <span class="text-xl">üìä</span>Exportar Excel
                        </button>
                    </div>
                    ${sortedGastos.length === 0 ? `
                        <p class="text-center text-gray-500 py-8">Nenhum gasto registrado ainda</p>
                    ` : `
                        <div class="space-y-3">
                            ${sortedGastos.map(gasto => `
                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 flex-wrap">
                                            <span class="px-2 py-1 rounded text-xs font-semibold ${gasto.tipo === 'fixo' ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'}">
                                                ${gasto.tipo === 'fixo' ? 'Fixo' : 'Vari√°vel'}
                                            </span>
                                            <span class="font-semibold text-gray-800">${gasto.categoria}</span>
                                            <span class="px-2 py-1 rounded text-xs font-semibold bg-orange-100 text-orange-700">üë§ ${gasto.responsavel}</span>
                                        </div>
                                        <p class="text-sm text-gray-600 mt-1">${gasto.descricao || 'Sem descri√ß√£o'}</p>
                                        <p class="text-xs text-gray-500 mt-1">${new Date(gasto.data + 'T00:00:00').toLocaleDateString('pt-BR')}</p>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <span class="text-xl font-bold text-gray-800">R$ ${gasto.valor.toFixed(2)}</span>
                                        <button onclick="handleRemoveGasto(${gasto.id})" class="text-red-500 hover:text-red-700 transition-colors">üóëÔ∏è</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function renderConfig() {
            return `
                <div class="bg-white rounded-xl shadow-md p-6 max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">‚öôÔ∏è Configura√ß√µes</h2>
                    <div class="space-y-6">
                        <div class="border-b border-gray-200 pb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">üîê Seguran√ßa</h3>
                            ${!state.showChangePassword ? `
                                <button onclick="state.showChangePassword = true; render();" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Alterar Senha
                                </button>
                            ` : `
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nova Senha</label>
                                        <input type="password" value="${state.newPassword}" onchange="state.newPassword = this.value; render();" placeholder="M√≠nimo 6 caracteres" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Nova Senha</label>
                                        <input type="password" value="${state.confirmPassword}" onchange="state.confirmPassword = this.value; render();" placeholder="Digite novamente" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                                    </div>
                                    ${state.passwordError ? `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">${state.passwordError}</div>` : ''}
                                    <div class="flex gap-3">
                                        <button onclick="state.showChangePassword = false; state.newPassword = ''; state.confirmPassword = ''; state.passwordError = ''; render();" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Cancelar</button>
                                        <button onclick="handleChangePassword()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Salvar</button>
                                    </div>
                                </div>
                            `}
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">üö™ Sess√£o</h3>
                            <button onclick="handleLogout()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">Sair do Sistema</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateFormData(field, value) {
            state.formData[field] = value;
            render();
        }

        function openAddCategory() {
            state.showAddCategory = true;
            render();
        }

        function openEditNames() {
            state.tempNome1 = state.nomes[0];
            state.tempNome2 = state.nomes[1];
            state.showEditNames = true;
            render();
        }

        function render() {
            if (!state.isAuthenticated) {
                document.getElementById('root').innerHTML = renderLogin();
                return;
            }

            const content = `
                <div class="container mx-auto px-4 py-8">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">üí∞ Controle Or√ßament√°rio Familiar</h1>
                        <p class="text-gray-600">Gerencie suas finan√ßas de forma simples e eficiente</p>
                    </div>
                    
                    <div class="flex justify-center mb-8">
                        <div class="bg-white rounded-lg shadow-md p-1 inline-flex gap-1 flex-wrap">
                            <button onclick="changeTab('dashboard')" class="px-4 md:px-6 py-2 rounded-md font-medium transition-colors ${state.activeTab === 'dashboard' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">Dashboard</button>
                            <button onclick="changeTab('adicionar')" class="px-4 md:px-6 py-2 rounded-md font-medium transition-colors ${state.activeTab === 'adicionar' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">Adicionar</button>
                            <button onclick="changeTab('graficos')" class="px-4 md:px-6 py-2 rounded-md font-medium transition-colors ${state.activeTab === 'graficos' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">üìä Gr√°ficos</button>
                            <button onclick="changeTab('historico')" class="px-4 md:px-6 py-2 rounded-md font-medium transition-colors ${state.activeTab === 'historico' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">Hist√≥rico</button>
                            <button onclick="changeTab('config')" class="px-4 md:px-6 py-2 rounded-md font-medium transition-colors ${state.activeTab === 'config' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">‚öôÔ∏è</button>
                        </div>
                    </div>
                    
                    <div class="max-w-7xl mx-auto">
                        ${state.activeTab === 'dashboard' ? renderDashboard() : ''}
                        ${state.activeTab === 'adicionar' ? renderAddGasto() : ''}
                        ${state.activeTab === 'graficos' ? renderGraficos() : ''}
                        ${state.activeTab === 'historico' ? renderHistorico() : ''}
                        ${state.activeTab === 'config' ? renderConfig() : ''}
                    </div>
                </div>

                ${state.showAddCategory ? `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-6 max-w-md w-full">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Adicionar Nova Categoria</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                                    <select onchange="state.categoryType = this.value; render();" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        <option value="fixo" ${state.categoryType === 'fixo' ? 'selected' : ''}>Fixo</option>
                                        <option value="variavel" ${state.categoryType === 'variavel' ? 'selected' : ''}>Vari√°vel</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Categoria</label>
                                    <input type="text" value="${state.newCategoryName}" onchange="state.newCategoryName = this.value" placeholder="Ex: Aluguel, Transporte" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                                </div>
                                <div class="flex gap-3 pt-2">
                                    <button onclick="state.showAddCategory = false; state.newCategoryName = ''; render();" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Cancelar</button>
                                    <button onclick="handleAddCategory()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Adicionar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${state.showEditNames ? `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-xl p-6 max-w-md w-full">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Personalizar Nomes</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pessoa 1</label>
                                    <input type="text" value="${state.tempNome1}" onchange="state.tempNome1 = this.value" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pessoa 2</label>
                                    <input type="text" value="${state.tempNome2}" onchange="state.tempNome2 = this.value" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/>
                                </div>
                                <div class="flex gap-3 pt-2">
                                    <button onclick="state.showEditNames = false; render();" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Cancelar</button>
                                    <button onclick="handleSaveNames()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Salvar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('root').innerHTML = content;
        }

        function changeTab(tab) {
            state.activeTab = tab;
            render();
            
            if (tab === 'graficos') {
                setTimeout(() => {
                    if (!state.selectedYear) {
                        const anos = getAnosDisponiveis();
                        state.selectedYear = anos.length > 0 ? anos[0] : new Date().getFullYear();
                    }
                    
                    if (!state.selectedCategory) {
                        const todasCategorias = [...state.categoriasFixas, ...state.categoriasVariaveis];
                        state.selectedCategory = todasCategorias[0] || 'Escola';
                    }
                    
                    criarGraficoMensal();
                    criarGraficoCategoria();
                }, 100);
            }
        }

        if (isFirebaseInitialized) {
            checkStoredPassword();
        }
        render();
    </script>
</body>
</html>